<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìˆ˜ë°• ê²Œì„</title>
<style>
  :root{
    --bg:#e6fff7;
    --panel:#ffffff;
    --accent:#10b981;
    --muted:#6b7280;
  }
  html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;}
  .wrap{display:flex;align-items:center;justify-content:center;height:100%;background:linear-gradient(180deg,var(--bg),#d8fff0);}
  .game-card{width:880px;max-width:96vw;background:var(--panel);border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,0.12);padding:16px;display:grid;grid-template-columns:1fr 250px;gap:12px;}
  canvas{background:linear-gradient(180deg,#bfffe8,#9fffe0);border-radius:8px;display:block;width:100%;height:600px;touch-action:none;}
  .panel{padding:12px;}
  h1{margin:0 0 8px 0;font-size:18px;color:#0f172a;}
  .stats{display:flex;flex-direction:column;gap:10px;font-size:15px;color:var(--muted);}
  .big{font-size:28px;font-weight:600;color:#065f46;}
  button{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;}
  .small{font-size:13px;color:#374151;}
  .control-row{display:flex;gap:8px;flex-wrap:wrap;}
  .footer{margin-top:12px;font-size:13px;color:#475569;}
  .hint{font-size:13px;color:#065f46;}
</style>
</head>
<body>
<div class="wrap">
  <div class="game-card" role="application" aria-label="ìˆ˜ë°• ì¡ê¸° ê²Œì„">
    <div>
      <h1>ğŸ‰ ìˆ˜ë°• ì¡ê¸°</h1>
      <canvas id="game" width="800" height="600"></canvas>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="small">â† â†’ ë˜ëŠ” í™”ë©´ í„°ì¹˜/ë“œë˜ê·¸ë¡œ ì´ë™</div>
        <div class="small hint">ìˆ˜ë°•ì„ ë§ì´ ì¡ì•„ ìµœê³ ì ìˆ˜ì— ë„ì „í•˜ì„¸ìš”!</div>
      </div>
    </div>

    <div class="panel">
      <div class="stats">
        <div>ì ìˆ˜: <span id="score" class="big">0</span></div>
        <div>ëª©ìˆ¨: <span id="lives" class="big">3</span></div>
        <div>ë ˆë²¨: <span id="level" class="big">1</span></div>
        <div>ìµœê³ ì : <span id="best" class="big">0</span></div>
      </div>

      <div style="margin-top:12px;">
        <div class="control-row">
          <button id="startBtn">ì‹œì‘</button>
          <button id="pauseBtn">ì¼ì‹œì •ì§€</button>
          <button id="resetBtn">ë¦¬ì…‹</button>
        </div>
      </div>

      <div class="footer">
        <p style="margin:8px 0 0 0">ê·œì¹™: ë–¨ì–´ì§€ëŠ” ìˆ˜ë°•ì„ ë°”êµ¬ë‹ˆë¡œ ë°›ìœ¼ë©´ +1ì , ë†“ì¹˜ë©´ ëª©ìˆ¨ -1. ë ˆë²¨ì´ ì˜¤ë¥´ë©´ ìˆ˜ë°• ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>
</div>

<script>
/* ìˆ˜ë°• ê²Œì„ â€” ë‹¨ì¼íŒŒì¼ ë²„ì „
 - ìº”ë²„ìŠ¤ ê¸°ë°˜ ê°„ë‹¨í•œ ê²Œì„
 - ì—”í‹°í‹°: í”Œë ˆì´ì–´(ë°”êµ¬ë‹ˆ), ë¬¼ì²´(ìˆ˜ë°•)
 - í‚¤ë³´ë“œ, ë§ˆìš°ìŠ¤/í„°ì¹˜ ì…ë ¥ ì§€ì›
*/

// ìº”ë²„ìŠ¤ ì…‹ì—…
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width;
const H = canvas.height;

// UI ìš”ì†Œ
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const levelEl = document.getElementById('level');
const bestEl = document.getElementById('best');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');

let running = false;
let paused = false;
let score = 0;
let lives = 3;
let level = 1;
let best = Number(localStorage.getItem('su_bak_best') || 0);

bestEl.textContent = best;

// í”Œë ˆì´ì–´(ë°”êµ¬ë‹ˆ)
const player = {
  w: 140,
  h: 28,
  x: (W - 140) / 2,
  y: H - 40,
  speed: 8,
  vx: 0
};

// ìˆ˜ë°•(ë–¨ì–´ì§€ëŠ” ê²ƒ) ë¦¬ìŠ¤íŠ¸
let items = [];
let spawnTimer = 0;
let spawnInterval = 90; // í”„ë ˆì„ ë‹¨ìœ„ (ì´ˆê¸°)
let gravity = 1.4;

// ë‚œì´ë„ ì¡°ì •
function updateDifficulty() {
  level = Math.floor(score / 10) + 1;
  spawnInterval = Math.max(22, 90 - (level - 1) * 6); // ë ˆë²¨ â†‘ => ìŠ¤í° ë¹¨ë¼ì§
  gravity = 1.4 + (level - 1) * 0.14;
}

// ì•„ì´í…œ ìƒì„±
function spawnItem() {
  const size = 34 + Math.random() * 22; // ìˆ˜ë°• í¬ê¸°
  const x = Math.random() * (W - size - 20) + 10;
  const vx = (Math.random() - 0.5) * 1.2; // ì•½ê°„ ì™¼/ì˜¤ ì´ë™
  items.push({
    x, y: -size,
    size,
    vy: 0,
    vx,
    type: 'watermelon'
  });
}

// ì¶©ëŒ ì²´í¬ (ì›ê³¼ ì‚¬ê°í˜• ëŒ€ëµì¶©ëŒ)
function checkCollision(item, ply) {
  // ì‚¬ê°í˜•(í”Œë ˆì´ì–´)ì™€ ì›(ìˆ˜ë°•) ì¶©ëŒ íŒì • (ì›-ì‚¬ê° ì¶©ëŒ)
  const cx = Math.max(ply.x, Math.min(item.x + item.size/2, ply.x + ply.w));
  const cy = Math.max(ply.y, Math.min(item.y + item.size/2, ply.y + ply.h));
  const dx = (item.x + item.size/2) - cx;
  const dy = (item.y + item.size/2) - cy;
  return (dx*dx + dy*dy) < (item.size/2) * (item.size/2);
}

// ê·¸ë¦¬ê¸°: ìˆ˜ë°• (ì‹¬í”Œí•˜ê²Œ ì› + ì¤„ë¬´ëŠ¬)
function drawWatermelon(x,y,size) {
  const r = size/2;
  // ê»ì§ˆ
  ctx.beginPath();
  ctx.ellipse(x + r, y + r, r, r*0.9, 0, 0, Math.PI*2);
  ctx.fillStyle = '#22c55e';
  ctx.fill();
  // ì¤„ë¬´ëŠ¬
  ctx.beginPath();
  ctx.ellipse(x + r, y + r, r*0.95, r*0.85, -0.2, -1.2, 1.2);
  ctx.strokeStyle = 'rgba(16,185,129,0.7)';
  ctx.lineWidth = Math.max(2, size/22);
  ctx.stroke();
  // ì†ì‚´ (ì˜ë¦° ëŠë‚Œ ì‘ì€ ë°˜ì›)
  ctx.beginPath();
  ctx.ellipse(x + r, y + r + size*0.06, r*0.72, r*0.5, 0, Math.PI*1.05, Math.PI*1.95);
  ctx.fillStyle = '#ff6b6b';
  ctx.fill();
  // ì”¨
  const seeds = 6;
  for(let i=0;i<seeds;i++){
    const ang = Math.PI*1.1 + (i/(seeds-1))*Math.PI*0.8;
    const sx = x + r + Math.cos(ang) * r*0.45;
    const sy = y + r + Math.sin(ang) * r*0.25;
    ctx.beginPath();
    ctx.ellipse(sx, sy, Math.max(1, size*0.03), Math.max(0.8, size*0.02), ang+0.6, 0, Math.PI*2);
    ctx.fillStyle = '#2b2b2b';
    ctx.fill();
  }
}

// ê·¸ë¦¬ê¸°: í”Œë ˆì´ì–´(ë°”êµ¬ë‹ˆ)
function drawPlayer() {
  // ë°”êµ¬ë‹ˆ ê·¸ë¦¼ì
  ctx.beginPath();
  ctx.ellipse(player.x + player.w/2, player.y + player.h + 8, player.w*0.48, 6, 0, 0, Math.PI*2);
  ctx.fillStyle = 'rgba(5,5,5,0.08)';
  ctx.fill();

  // ë°”êµ¬ë‹ˆ ë³¸ì²´
  ctx.fillStyle = '#3b82f6';
  roundRect(ctx, player.x, player.y, player.w, player.h, 8, true, false);

  // íŒ¨í„´
  ctx.fillStyle = '#60a5fa';
  for(let i=0;i<4;i++){
    const bx = player.x + 10 + i*(player.w-20)/4;
    ctx.fillRect(bx, player.y+6, (player.w-40)/8, player.h-12);
  }
}

// ìœ í‹¸: ë‘¥ê·¼ ì‚¬ê°í˜•
function roundRect(ctx, x, y, w, h, r, fill, stroke) {
  if (r===undefined) r = 5;
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
  if (fill) ctx.fill();
  if (stroke) ctx.stroke();
}

// ì—…ë°ì´íŠ¸ ë£¨í”„
let frame = 0;
function update() {
  if(!running || paused) return;
  frame++;
  // í”Œë ˆì´ì–´ ì´ë™
  player.x += player.vx;
  if (player.x < 8) player.x = 8;
  if (player.x + player.w > W - 8) player.x = W - 8 - player.w;

  // ìŠ¤í° íƒ€ì´ë¨¸
  spawnTimer++;
  if (spawnTimer >= spawnInterval) {
    spawnTimer = 0;
    spawnItem();
  }

  // ì•„ì´í…œ ì—…ë°ì´íŠ¸
  for (let i = items.length-1; i>=0; i--) {
    const it = items[i];
    it.vy += gravity * 0.06; // í”„ë ˆì„ë³„ ê°€ì† (í”„ë ˆì„ë¹„ ë³´ì •)
    it.y += it.vy;
    it.x += it.vx;

    // ë°”êµ¬ë‹ˆì™€ ì¶©ëŒ?
    if (checkCollision(it, player)) {
      score += 1;
      updateDifficulty();
      scoreEl.textContent = score;
      levelEl.textContent = level;
      // íŒŒí‹°í´ íš¨ê³¼ ëŒ€ì‹  ì‘ì€ íŠ€ê¹€(ì•„ì´í…œ ì œê±°)
      items.splice(i,1);
      continue;
    }

    // ë°”ë‹¥ì— ë‹¿ìŒ (ë†“ì¹¨)
    if (it.y > H) {
      items.splice(i,1);
      lives -= 1;
      livesEl.textContent = lives;
      if (lives <= 0) {
        gameOver();
        return;
      }
    }
  }

  // ìµœê³ ì  ì—…ë°ì´íŠ¸
  if (score > best) {
    best = score;
    bestEl.textContent = best;
    localStorage.setItem('su_bak_best', best);
  }
}

// ë Œë”ë§
function render() {
  // ë°°ê²½
  ctx.clearRect(0,0,W,H);

  // í•˜ëŠ˜/ë¬´ëŠ¬
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#cffff0');
  g.addColorStop(1,'#a8fff0');
  ctx.fillStyle = g;
  roundRect(ctx, 0, 0, W, H, 12, true, false);

  // ë°”ë‹¥(ì”ë”” ëŠë‚Œ)
  ctx.fillStyle = '#16a34a';
  ctx.fillRect(0, H-40, W, 40);

  // ì•„ì´í…œ ê·¸ë¦¬ê¸°
  for (const it of items) {
    drawWatermelon(it.x, it.y, it.size);
  }

  // í”Œë ˆì´ì–´
  drawPlayer();

  // HUD (ê°„ë‹¨)
  ctx.fillStyle = 'rgba(255,255,255,0.6)';
  ctx.font = '14px system-ui, -apple-system, "Segoe UI", Roboto';
  ctx.fillText('Score: ' + score, 12, 22);
  ctx.fillText('Lives: ' + lives, 12, 40);
}

// ë©”ì¸ ë£¨í”„
function loop() {
  if (running && !paused) {
    update();
    render();
  } else {
    // ì •ì§€ ìƒíƒœì—¬ë„ ìº”ë²„ìŠ¤ëŠ” ë Œë” (ì •ì§€ í™”ë©´ í‘œì‹œ)
    render();
  }
  requestAnimationFrame(loop);
}

// ì‹œì‘ / ì¼ì‹œì •ì§€ / ë¦¬ì…‹
function startGame() {
  if (!running) {
    running = true;
    paused = false;
    score = 0;
    lives = 3;
    level = 1;
    items = [];
    spawnTimer = 0;
    player.x = (W - player.w)/2;
    updateDifficulty();
    scoreEl.textContent = score;
    livesEl.textContent = lives;
    levelEl.textContent = level;
  } else {
    paused = false;
  }
}

function pauseGame() {
  if (!running) return;
  paused = !paused;
}

function resetGame() {
  running = false;
  paused = false;
  score = 0;
  lives = 3;
  level = 1;
  items = [];
  spawnTimer = 0;
  player.x = (W - player.w)/2;
  scoreEl.textContent = score;
  livesEl.textContent = lives;
  levelEl.textContent = level;
}

// ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬
function gameOver() {
  running = false;
  paused = false;
  // ê°„ë‹¨í•œ ì˜¤ë²„ í…ìŠ¤íŠ¸
  ctx.fillStyle = 'rgba(0,0,0,0.55)';
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle = '#fff';
  ctx.font = '48px system-ui, -apple-system, "Segoe UI", Roboto';
  ctx.textAlign = 'center';
  ctx.fillText('GAME OVER', W/2, H/2 - 10);
  ctx.font = '20px system-ui, -apple-system, "Segoe UI", Roboto';
  ctx.fillText('ì ìˆ˜: ' + score + '   ìµœê³ ì : ' + best, W/2, H/2 + 28);
}

// ì…ë ¥ ì²˜ë¦¬: í‚¤ë³´ë“œ
const keys = {};
window.addEventListener('keydown', (e) => {
  keys[e.key] = true;
  if (e.key === 'ArrowLeft' || e.key === 'a') player.vx = -player.speed;
  if (e.key === 'ArrowRight' || e.key === 'd') player.vx = player.speed;
  if (e.key === ' ' && !running) startGame();
  if (e.key === 'p') pauseGame();
});
window.addEventListener('keyup', (e) => {
  keys[e.key] = false;
  if (!keys['ArrowLeft'] && !keys['a'] && (e.key === 'ArrowLeft' || e.key === 'a')) player.vx = 0;
  if (!keys['ArrowRight'] && !keys['d'] && (e.key === 'ArrowRight' || e.key === 'd')) player.vx = 0;
});

// ë§ˆìš°ìŠ¤/í„°ì¹˜ ë“œë˜ê·¸ë¡œ ì´ë™
let dragging = false;
function pointerMove(clientX) {
  const rect = canvas.getBoundingClientRect();
  const x = (clientX - rect.left) * (canvas.width / rect.width);
  // í”Œë ˆì´ì–´ ì¤‘ì‹¬ì„ í¬ì¸í„°ì— ë§ì¶”ê¸°
  player.x = x - player.w/2;
  if (player.x < 8) player.x = 8;
  if (player.x + player.w > W - 8) player.x = W - 8 - player.w;
}
canvas.addEventListener('mousedown', (e) => {
  dragging = true;
  pointerMove(e.clientX);
});
window.addEventListener('mousemove', (e) => {
  if (dragging) pointerMove(e.clientX);
});
window.addEventListener('mouseup', () => dragging = false);
canvas.addEventListener('touchstart', (e) => {
  dragging = true;
  pointerMove(e.touches[0].clientX);
  e.preventDefault();
});
canvas.addEventListener('touchmove', (e) => {
  if (dragging) pointerMove(e.touches[0].clientX);
  e.preventDefault();
});
canvas.addEventListener('touchend', () => { dragging = false; });

// ë²„íŠ¼ ë°”ì¸ë”©
startBtn.addEventListener('click', () => startGame());
pauseBtn.addEventListener('click', () => { pauseGame(); pauseBtn.textContent = paused ? 'ê³„ì†' : 'ì¼ì‹œì •ì§€'; });
resetBtn.addEventListener('click', () => { resetGame(); pauseBtn.textContent = 'ì¼ì‹œì •ì§€'; });

// ì´ˆê¸° ë Œë”ì™€ ë£¨í”„ ì‹œì‘
render();
requestAnimationFrame(loop);
</script>
</body>
</html>
