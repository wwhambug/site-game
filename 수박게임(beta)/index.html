<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ˜ë°• ê²Œì„ ğŸ‰</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#fef6e4; display:flex; flex-direction:column; align-items:center; font-family:sans-serif; }
    h1 { margin:10px 0; }
    canvas { background:#d8f3dc; border:3px solid #40916c; border-radius:10px; }
    #scoreBoard { font-size:20px; margin:10px; }
  </style>
</head>
<body>
  <h1>ğŸ’ ìˆ˜ë°• ê²Œì„ ğŸ‰</h1>
  <div id="scoreBoard">ì ìˆ˜: 0 | ìµœê³ ì ìˆ˜: 0</div>
  <canvas id="game" width="400" height="600"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreBoard = document.getElementById("scoreBoard");

    // ê³¼ì¼ ëª©ë¡ (ì‘ì„ìˆ˜ë¡ ê°€ë³ê³ , í´ìˆ˜ë¡ ë¬´ê±°ì›€)
    const fruits = [
      {color:"#ff4d6d", radius:15, name:"ì²´ë¦¬"},
      {color:"#ff7096", radius:20, name:"ë”¸ê¸°"},
      {color:"#9d4edd", radius:25, name:"í¬ë„"},
      {color:"#ffb703", radius:30, name:"ì‚¬ê³¼"},
      {color:"#ffee32", radius:35, name:"ë ˆëª¬"},
      {color:"#70e000", radius:45, name:"ë©œë¡ "},
      {color:"#008000", radius:55, name:"ìˆ˜ë°•"},
      {color:"#a3c4f3", radius:65, name:"ë¸”ë£¨ë² ë¦¬"},
      {color:"#e5989b", radius:75, name:"ë³µìˆ­ì•„"},
      {color:"#cdb4db", radius:85, name:"ìë‘"},
      {color:"#6a994e", radius:95, name:"ì°¸ì™¸"},
      {color:"#8ecae6", radius:105, name:"ë§ê³ "},
      {color:"#f28482", radius:115, name:"ìëª½"},
      {color:"#d00000", radius:130, name:"ì„ë¥˜"},
      {color:"#ffba08", radius:150, name:"í™©ê¸ˆìˆ˜ë°•"}
    ];

    let objects = [];
    let dropping = null;
    let score = 0;
    let highScore = Number(localStorage.getItem("highScore") || 0);
    let gameOver = false;

    function randomFruit() {
      return {...fruits[0], type:0}; // ì²´ë¦¬ë¶€í„° ì‹œì‘
    }

    function dropFruit() {
      if (dropping || gameOver) return;
      dropping = randomFruit();
      dropping.x = canvas.width / 2;
      dropping.y = 60;
      dropping.vx = 0;
      dropping.vy = 0;
    }

    document.addEventListener("mousemove", e => {
      if (dropping) {
        const rect = canvas.getBoundingClientRect();
        dropping.x = e.clientX - rect.left;
      }
    });

    document.addEventListener("click", () => {
      if (!dropping || gameOver) return;
      objects.push(dropping);
      dropping = null;
      dropFruit();
    });

    function update() {
      if (gameOver) return;

      // ê³¼ì¼ ì¤‘ë ¥/ì´ë™ ì²˜ë¦¬
      for (let o of objects) {
        const weight = 0.05 + o.radius / 200; // í´ìˆ˜ë¡ ë¬´ê²ê²Œ
        o.vy += weight * 3; // ì¤‘ë ¥
        o.y += o.vy;
        o.x += o.vx;
        o.vx *= 0.98; // ê³µê¸°ì €í•­

        // ë°”ë‹¥ ì¶©ëŒ
        if (o.y + o.radius > canvas.height) {
          o.y = canvas.height - o.radius;
          o.vy *= -0.3; // íŠ•ê¹€
          o.vx *= 0.7; // ë¬´ê±°ìš¸ìˆ˜ë¡ ëœ ì›€ì§ì„
          if (Math.abs(o.vy) < 0.5) o.vy = 0;
        }

        // ë²½ ì¶©ëŒ
        if (o.x - o.radius < 0 || o.x + o.radius > canvas.width) {
          o.vx *= -0.8;
          o.x = Math.max(o.radius, Math.min(canvas.width - o.radius, o.x));
        }
      }

      // ì¶©ëŒ ì²˜ë¦¬ (í•­ìƒ í™•ì¸)
      for (let i = 0; i < objects.length; i++) {
        for (let j = i + 1; j < objects.length; j++) {
          const a = objects[i];
          const b = objects[j];
          const dx = a.x - b.x;
          const dy = a.y - b.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < a.radius + b.radius) {
            // ì„œë¡œ ë¯¸ëŠ” ë¬¼ë¦¬ íš¨ê³¼
            const overlap = (a.radius + b.radius - dist) / 2;
            const nx = dx / dist;
            const ny = dy / dist;
            a.x += nx * overlap;
            a.y += ny * overlap;
            b.x -= nx * overlap;
            b.y -= ny * overlap;

            // ì¶©ëŒ í›„ í•©ì„±
            if (Math.abs(a.vy - b.vy) < 2 && a.type === b.type && a.type < fruits.length - 1) {
              const next = fruits[a.type + 1];
              objects.splice(j, 1);
              objects.splice(i, 1);
              const newFruit = {...next, x:(a.x+b.x)/2, y:(a.y+b.y)/2, vx:0, vy:-5, type:a.type+1};
              objects.push(newFruit);
              score += (a.type + 1) * 10;
              updateScore();
              break;
            }
          }
        }
      }

      // ê²Œì„ì˜¤ë²„ íŒì • (ë†’ì´)
      for (let o of objects) {
        if (o.y - o.radius < 50) {
          endGame();
          return;
        }
      }
    }

    function updateScore() {
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("highScore", highScore);
      }
      scoreBoard.innerText = `ì ìˆ˜: ${score} | ìµœê³ ì ìˆ˜: ${highScore}`;
    }

    function endGame() {
      gameOver = true;
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.font = "32px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("ê²Œì„ ì˜¤ë²„!", canvas.width/2, canvas.height/2);
      ctx.font = "20px sans-serif";
      ctx.fillText("í´ë¦­í•˜ë©´ ë‹¤ì‹œ ì‹œì‘", canvas.width/2, canvas.height/2 + 40);

      document.addEventListener("click", resetGame, {once:true});
    }

    function resetGame() {
      objects = [];
      dropping = null;
      score = 0;
      gameOver = false;
      updateScore();
      dropFruit();
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // ë“œë¡­ ì¤‘ ê³¼ì¼
      if (dropping) {
        ctx.fillStyle = dropping.color;
        ctx.beginPath();
        ctx.arc(dropping.x, dropping.y, dropping.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.font = "12px bold sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(dropping.type ?? 0, dropping.x, dropping.y+4);
      }
      // ë–¨ì–´ì§„ ê³¼ì¼
      for (let o of objects) {
        ctx.fillStyle = o.color;
        ctx.beginPath();
        ctx.arc(o.x, o.y, o.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.font = "12px bold sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(o.type ?? 0, o.x, o.y+4);
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    updateScore();
    dropFruit();
    loop();
  </script>
</body>
</html>
